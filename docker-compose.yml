version: "3"

services:



  socketio_1:
    build: ./microservices/socketio
    hostname: socketio_1
    restart: always
    environment:
      - PORT=4500
      - REDIS_HOST=redis
    depends_on: 
      - redis

  socketio_2:
    build: ./microservices/socketio
    hostname: socketio_2
    restart: always
    environment:
      - PORT=4501
      - REDIS_HOST=redis
    depends_on: 
      - redis

  socketio_3:
    build: ./microservices/socketio
    hostname: socketio_3
    restart: always
    environment:
      - PORT=4502
      - REDIS_HOST=redis
    depends_on: 
      - redis



  redis:
    build: ./microservices/redis
    hostname: redis
    restart: always


  # EXECUTE BINANCE SERVER FOR usd
  binance_exchange_usd:
    build: ./microservices/exchange_server
    hostname: binance_exchange_usd
    restart: always
    environment:
      - PORT=8001
      - DEDICATED_TO=BINANCE
      - MAIN_COIN=USD
      - REDIS_HOST=redis
      - NODE_ENV=production
    depends_on:
      - redis
    links:
      - redis
  

  # # EXECUTE BINANCE SERVER FOR ETH
  binance_exchange_eth:
    build: ./microservices/exchange_server
    hostname: binance_exchange_eth
    restart: always
    environment:
      - PORT=8002
      - DEDICATED_TO=BINANCE
      - MAIN_COIN=ETH
      - REDIS_HOST=redis
      - NODE_ENV=production
    depends_on:
      - redis
    links:
      - redis


  # EXECUTE GDAX SERVER FOR USD
  gdax_exchange_usd:
    build: ./microservices/exchange_server
    hostname: gdax_exchange_usd
    restart: always
    environment:
      - PORT=8202
      - DEDICATED_TO=GDAX
      - MAIN_COIN=USD
      - REDIS_HOST=redis
      - NODE_ENV=production
    depends_on:
      - redis
    links:
      - redis

  news_server:
    build: ./microservices/news_server
    restart: always
    environment:
      - REDIS_HOST=redis
      - NODE_ENV=production
    depends_on:
      - redis
    links:
      - redis

  # EXECUTE NGINX SERVER
  nginx:
    build: .
    restart: always
    ports:
      - "80:80"
    volumes:
      - ./packages/public/client/build:/usr/share/nginx/html
    links:
      - socketio_1
      - socketio_2
      - socketio_3